# optimization

* 同一のcppファイルに関数を記述した場合にはその関数はinline展開されて関数自体がなくなることがある
  * つまり，定数の引数を指定したカリー化?した状態での呼び出しはできる
  * プロトタイプ宣言のありなしは関係ない
  * `-pg`を付加すると明示的な関数を呼び出していなくとも`mcount`がcallされているよう
* ほぼ同等の内容を別のcppファイルに記述することで，関数が明示的に呼ばれる
  * コンパイル時に同時にcppを指定してもオブジェクトファイルとしても同様
  * つまり，定数の引数を指定したカリー化?した状態での呼び出しはできない
  * オブジェクトファイルの関数のコンパイル時の最適化を行う方法は?
    * 明示的に定数値を指定してその関数をコンパイルして公開する方法しかなさそう

* 一部が定数の場合の恩恵を受けるためには，ヘッダに記述する必要があるため，基本的にinlineでなくてはならない
* その場合，同一のアドレスに命令があるわけではないので，命令のデコードのキャッシュは働かなくなる
* 別のcppファイルにある時点でその関数の中身は見えない前提となるため，最適化の妨げになってしまう

```
$ g++ -std=c++11 -O3 -g main.cpp f.cpp -DSAME_FILE
$ time ./a.out
0.000000
./a.out  0.00s user 0.00s system 72% cpu 0.005 total

$ g++ -std=c++11 -O3 -g main.cpp f.cpp
$ time ./a.out
^C
```
