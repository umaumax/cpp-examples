# vector

## structのfieldの型(vector vs. array)
* struct自体の配列の長さやそのstructが持つfieldのarray(or vector)の長さに起因するが，例えば，下記のようにcacheが効いている条件下でも10倍以上アクセス速度さが生じる
  * `array`: structのarrayの構造がそのまま連続領域となる
  * `vector`: structのvectorが指し示す先のアドレスにアクセスをする必要性があるため，その参照時間がかかる
```
array
calc elapsed time:    111090[us]
vector
calc elapsed time:   1812451[us]
```

```
g++ -std=c++11 -O3 vector_vs_array.cpp
```

* static_vector
  * 実は固定長で運用可能な`std::vector`のコードを簡易的に置き換えることはできないかどうかという試み
  * structのfieldのこの型を他の関数の呼び出しで利用している場合には，単純に置換しただけでは不十分な挙動となる
  * [【C\+\+】既存のクラスを拡張する方法【拡張メソッド／カテゴリ】 \| MaryCore]( https://marycore.jp/prog/cpp/class-extension-methods/ )

## vector and array rewriting case
* vectorをarrayに置き換えてから，要素のアクセス順番を変更する際の注意点
  * `vector<vector<>>`の場合は`[i][j]`を`[j][i]`に変更すると範囲外アクセスエラーとなる
  * `array<array<>>`の場合は`[i][j]`を`[j][i]`に変更しても，実質範囲内に収まるので，範囲外アクセスエラーとならないことに注意

## multi_dim_vector_memory_map
多次元配列代わりのvectorのmemory mapの調査

実行環境(mallocの動作)依存
```
$ ./a.out 64 8 2
1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}1818181818181818{12}18181818181818
```
* `1818`は`[0001][1000][0001][1000]`を示す(16Bを16進数で表現し，`1`が立っている箇所はメモリが確保されている状態)
  * 上記の並びの区切りを変更すると`[000][11][000000][11][000]`となり，これは`[11]`が`i=2`に対応し，`[000000]`は24Bであり，これは`sizeof(std::vector<int>)`となる
```
sed 's/1818181818181818{12}/*/g'
```
```
***************************************************************18181818181818
```

* `./a.out 64 8 4`とすると`1e`は`[0001][1110]`=>`[000][1111][0]`であり，この`[1111]`は`i=4`に対応する
```
$ ./a.out 64 8 4
1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e1e{12}1e1e1e1e1e1e1e
```
